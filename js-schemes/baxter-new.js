/* 白一平轉寫 */

if (!音韻地位) return [
  ['版本', [2, '1992', '2014']],
];

const is = (...x) => 音韻地位.屬於(...x);

function get聲母() {
  if (選項.版本 === '1992' && is`影母`) {
    return 'ʔ|ʔ';
  }

  const 聲母 = {
    幫: 'p|p', 滂: 'ph|pʰ', 並: 'b|b', 明: 'm|m',
    端: 't|t', 透: 'th|tʰ', 定: 'd|d', 泥: 'n|n', 來: 'l|l',
    知: 'tr|ʈ', 徹: 'trh|ʈʰ', 澄: 'dr|ɖ', 孃: 'nr|ɳ',
    精: 'ts|ts', 清: 'tsh|tsʰ', 從: 'dz|dz', 心: 's|s', 邪: 'z|z',
    莊: 'tsr|ʈʂ', 初: 'tsrh|ʈʂʰ', 崇: 'dzr|ɖʐ', 生: 'sr|ʂ', 俟: 'zr|ʐ',
    章: 'tsy|tɕ', 昌: 'tsyh|tɕʰ', 常: 'dzy|dʑ', 日: 'ny|ȵ',
    書: 'sy|ɕ', 船: 'zy|ʑ', 以: 'y|j',
    見: 'k|k', 溪: 'kh|kʰ', 羣: 'g|g', 疑: 'ng|ŋ',
    影: "'|ʔ", 曉: 'x|x', 匣: 'h|ɦ', 云: 'h|ɦ',
  }[音韻地位.母];

  return 聲母;
}

function get介音() {
  let 介音 = '';
  
  if (is`三等 非 蒸之脂真臻侵韻`) 介音 = 'j';

  // 東歌麻庚韻同時含三等與非三等，此處處理三等
  // 「四等」是考慮端組在內
  if (is`東歌麻庚韻 三四等`) 介音 = 'j';

  // 章組或日以母只與三等韻相拼，省去韻母起始的 j
  // todo: 韻母.startsWith('j')
  if (is`章組 或 日以母` && 介音 === 'j') 介音 = '|j';

  if (is`之蒸`) return '';

  // 重紐 A 類添加 j 或 i
  if (is`A類 非 麻幽陽韻`) {
      if (介音 === 'j') 介音 = 'ji';
      else 介音 = 'j';
  }

  if (is`(合口 或 灰魂韻) 非 虞文凡韻`) {
    if (介音 === 'j') 介音 = 'jw';
    else 介音 = 'w';
  }

  return 介音;
}

function get韻核() {
  // 參考原始碼 baxter.js 韻母表
  let 韻核 = {
    // 一等韻
    東: 'uw|u', 冬: 'ow|ou', 模: 'u',
    泰: 'a', 灰: 'o', 咍: 'o',
    魂: 'o', 痕: 'o', 寒: 'a',
    豪: 'a', 歌: 'a', 唐: 'a',
    登: 'o', 侯: 'u', 覃: 'o',
    談: 'a',

    // 二等韻
    江: 'ae|æ', 佳: 'ea|ɛ', 皆: 'ea|ɛ',
    夬: 'ae|æ', 刪: 'ae|æ', 山: 'ea|ɛ',
    肴: 'ae|æ', 麻: 'ae|æ', 庚: 'ae|æ',
    耕: 'ea|ɛ', 咸: 'ea|ɛ', 銜: 'ae|æ',

    // 四等韻
    齊: 'e', 先: 'e', 蕭: 'e',
    青: 'e', 添: 'e',

    // 三等陰聲韻
    支: 'e', 脂: 'i', 之: 'i|ɨ', 微: '+|ɨ', 
    魚: 'o', 虞: 'u',
    祭: 'e', 廢: 'o',
    宵: 'e', 尤: 'u', 幽: 'i',

    // 三等陽聲韻
    // 東: 'uw|u',
    鍾: 'ow|ou',
    真: 'i', 臻: 'i', 文: 'u', 殷: '+|ɨ',
    元: 'o', 仙: 'e', 
    陽: 'a',
    // 庚： 'ae|æ',
    清: 'e', 蒸: 'i',
    侵: 'i', 鹽: 'e', 嚴: 'ae|æ', 凡: 'o'
  }[音韻地位.韻];

  // 1992版本特殊處理
  if (選項.版本 === '1992') {
    if (is`佳韻`) 韻核: 'ɛɨ|ɛ/ɨ'
    韻核 = 韻核.replace('+', 'ɨ').replace('ae', 'æ').replace('ea', 'ɛ');
  }

  return 韻核;
}

function get韻尾() {
  const 韻尾字典 = {
    // 陽聲韻
    東: 'ng|ŋ', 鍾: 'ng|ŋ', 冬: 'ng|ŋ', 江: 'ng|ŋ',
    唐: 'ng|ŋ', 庚: 'ng|ŋ', 登: 'ng|ŋ',
    真: 'n', 臻: 'n', 殷: 'n', 文: 'n', 元: 'n', 寒: 'n',
    痕: 'n', 魂: 'n', 先: 'n', 仙: 'n', 山: 'n', 刪: 'n',
    陽: 'ng|ŋ', 清: 'ng|ŋ', 青: 'ng|ŋ', 蒸: 'ng|ŋ', 耕: 'ng|ŋ',
    侵: 'm', 鹽: 'm', 添: 'm', 嚴: 'm', 凡: 'm',
    談: 'm', 覃: 'm', 咸: 'm', 銜: 'm',

    // 陰聲韻
    泰: 'j', 灰: 'j', 咍: 'j',
    皆: 'j', 夬: 'j',
    脂: 'j', 微: 'j',
    祭: 'j', 廢: 'j',
    齊: 'j',
    豪: 'w', 肴: 'w', 宵: 'w', 蕭: 'w',
    侯: 'w', 尤: 'w', 幽: 'w',
  };

  let 韻尾 = 韻尾字典[音韻地位.韻] || '';

  // 入聲韻對應平聲韻
  if (is`入聲`) {
    const 平聲韻尾 = 韻尾.split('|')[0];
    if (平聲韻尾 === 'm') return 'p';
    if (平聲韻尾 === 'n') return 't';
    if (平聲韻尾 === 'ng') return 'k';
  }

  return 韻尾;
}

function get聲調() {
  return {
    平: '|33',
    上: 'X|35',
    去: 'H|31',
    入: '|42'
  }[音韻地位.聲] || '|';
}

function get音節() {
  const 音節 = {
    聲母: get聲母(),
    介音: get介音(),
    韻核: get韻核(),
    韻尾: get韻尾(),
    聲調: get聲調()
  };
  console.log(字頭, 音韻地位, 音節);
  return 音節;
}

return get音節();